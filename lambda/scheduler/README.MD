# AWS Lambda Scheduler - Node.js Runtime

AWS resource scheduler for cost optimization using **Node.js** runtime. Automatically starts and stops EC2, RDS, ECS, ASG, and DocumentDB resources based on configured schedules.

## ğŸ“‹ Prerequisites

### For Local Development
- [Node.js](https://nodejs.org/) >= 20.0.0
- AWS credentials configured (via AWS CLI or environment variables)
- Access to DynamoDB tables for schedule configuration

### For AWS Lambda Deployment
- AWS CLI configured
- CDK / SAM / Serverless framework (whichever is being used)
- Lambda execution role with appropriate permissions

## ğŸ› ï¸ Local Development Setup

### 1. Install Dependencies

```bash
npm install
```

### 2. Configure Environment

Create a `.env` file based on `.env.example`:

```bash
cp .env.example .env
```

Required environment variables:
```env
AWS_REGION=us-east-1
AWS_PROFILE=your-aws-profile
APP_TABLE_NAME=cost-optimization-scheduler-app-table
AUDIT_TABLE_NAME=cost-optimization-scheduler-audit-table
```

### 3. Run Locally

#### Full Scan Mode (process all schedules)
```bash
npm run dev
# or
npm run dev:full
```

#### Partial Scan Mode (process specific schedule)
```bash
npm run dev:partial -- --scheduleId=your-schedule-id
# or by name
AWS_SDK_LOAD_CONFIG=1 tsx src/local-runner.ts --mode=partial --scheduleName=your-schedule-name
```

### 4. Type Checking

```bash
npm run typecheck
```

### 5. Testing

```bash
# Run all tests
npm test

# Watch mode
npm run test:watch
```

## ğŸ—ï¸ Architecture

```
scheduler/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # Lambda handler entry point
â”‚   â”œâ”€â”€ local-runner.ts       # Local development runner
â”‚   â”œâ”€â”€ services/             # Business logic services
â”‚   â”‚   â”œâ”€â”€ scheduler-service.ts
â”‚   â”‚   â”œâ”€â”€ dynamodb-service.ts
â”‚   â”‚   â”œâ”€â”€ sts-service.ts
â”‚   â”‚   â””â”€â”€ execution-history-service.ts
â”‚   â”œâ”€â”€ resource-schedulers/  # Resource-specific schedulers
â”‚   â”‚   â”œâ”€â”€ ec2-scheduler.ts
â”‚   â”‚   â”œâ”€â”€ rds-scheduler.ts
â”‚   â”‚   â”œâ”€â”€ ecs-scheduler.ts
â”‚   â”‚   â”œâ”€â”€ asg-scheduler.ts
â”‚   â”‚   â””â”€â”€ docdb-scheduler.ts
â”‚   â”œâ”€â”€ types/                # TypeScript type definitions
â”‚   â””â”€â”€ utils/                # Utility functions
â”œâ”€â”€ package.json              # Dependencies
â”œâ”€â”€ tsconfig.json            # TypeScript configuration
â””â”€â”€ .dockerignore           # Docker build exclusions
```

## ğŸ” IAM Permissions Required

The Lambda execution role needs:
- `dynamodb:Query`, `dynamodb:GetItem`, `dynamodb:PutItem`, `dynamodb:UpdateItem`
- `sts:AssumeRole` for cross-account access
- `logs:CreateLogGroup`, `logs:CreateLogStream`, `logs:PutLogEvents`
- `ec2:*`, `rds:*`, `ecs:*`, `autoscaling:*` (via assumed roles in target accounts)

## ğŸ“„ License

ISC
